#
# Copyright 2018, Mokshasoft AB (mokshasoft.com)
#
# This software may be distributed and modified according to the terms of
# the BSD 2-Clause license. Note that NO WARRANTY is provided.
# See "LICENSE_BSD2.txt" for details.
#

apps-$(CONFIG_APP_HELLO_IDRIS_1) += hello-idris-1

# Set up variables for the Idris compilation
APP_DIR := ./apps/hello-idris-1
IDRIS_FILES := $(wildcard $(APP_DIR)/src/*.idr)
IDRIS_APP_BUILD_DIR = $(BUILD_BASE)/hello-idris-1
IDRIS_GENERATED_APP_SRC = $(IDRIS_APP_BUILD_DIR)/hello-idris-1.c

# Compile the Idris code to C
hello-idris-1.c: $(IDRIS_FILES)
	@echo "Compiling Idris code to C..."
	$(Q)mkdir -p $(IDRIS_APP_BUILD_DIR)
	$(Q)idris \
		--ibcsubdir $(IDRIS_APP_BUILD_DIR) \
		--idrispath $(APP_DIR)/src \
		--codegen C --codegenonly -o $(IDRIS_GENERATED_APP_SRC) \
		$(APP_DIR)/src/Main.idr

# Libraries needed by the app
hello-idris-1-y = \
    common \
    libsel4 \
    libmuslc \
    libsel4muslcsys \
    libsel4platsupport \
    libsel4-idris-rts \
    libutils \
    libsel4utils \
    libsel4debug

# App
hello-idris-1: \
    kernel_elf \
    $(hello-idris-1-y) \
    hello-idris-1.c
